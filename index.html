<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Horas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: #f8fafc;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar - Novo estilo mais moderno */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 24px 0;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 0 24px;
            margin-bottom: 32px;
        }

        .sidebar-header h2 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-left: 4px solid #3b82f6;
            padding-left: 16px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            padding: 14px 24px;
            margin: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        .sidebar-nav li:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .sidebar-nav li.active {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 32px;
            background-color: #f8fafc;
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-header h1 {
            color: #0f172a;
            font-size: 1.875rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* Cards Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.green { background: #dcfce7; color: #16a34a; }
        .stat-icon.red { background: #fee2e2; color: #dc2626; }
        .stat-icon.purple { background: #f3e8ff; color: #9333ea; }

        .stat-title {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stat-value {
            color: #0f172a;
            font-size: 2rem;
            font-weight: 700;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bot√µes */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background-color: white;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background-color: #f8fafc;
            border-color: #cbd5e1;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        /* Modal - Novo estilo */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            margin: 40px auto;
            padding: 32px;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .modal-content h2 {
            color: #0f172a;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 24px;
        }

        /* Formul√°rios */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s;
            background-color: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            pointer-events: none;
        }

        /* Tabelas */
        .table-container {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px;
            color: #64748b;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            color: #1e293b;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background-color: #f8fafc;
        }

        /* Lan√ßamento Card - Estilo igual √† imagem */
        .lancamento-card {
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }

        .lancamento-header {
            margin-bottom: 32px;
        }

        .lancamento-header h2 {
            color: #0f172a;
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .lancamento-header p {
            color: #64748b;
            font-size: 1rem;
        }

        .lancamento-field {
            margin-bottom: 24px;
        }

        .lancamento-field label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .lancamento-field select,
        .lancamento-field input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1rem;
            background: white;
            appearance: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lancamento-field select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        .lancamento-field select:focus,
        .lancamento-field input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
            outline: none;
        }

        .month-picker {
            display: flex;
            gap: 12px;
        }

        .month-picker select {
            flex: 1;
        }

        .format-hint {
            display: block;
            margin-top: 8px;
            color: #64748b;
            font-size: 0.875rem;
        }

        .format-hint i {
            color: #94a3b8;
            margin-right: 4px;
        }

        .lancamento-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 2px solid #f1f5f9;
        }

        .btn-lancamento {
            padding: 14px 32px;
            border: none;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel {
            background-color: #f1f5f9;
            color: #475569;
        }

        .btn-cancel:hover {
            background-color: #e2e8f0;
        }

        .btn-save {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
        }

        /* Filtros */
        .filters-bar {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            background: white;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-warning {
            background: #fef9c3;
            color: #854d0e;
        }

        /* Alertas */
        .alert {
            padding: 16px 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            font-weight: 500;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .hidden {
            display: none;
        }

        /* Tabs */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Compet√™ncia picker igual √† imagem */
        .competencia-picker {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8fafc;
            padding: 4px 4px 4px 16px;
            border-radius: 40px;
            border: 2px solid #e2e8f0;
        }

        .competencia-picker select {
            border: none;
            background: transparent;
            padding: 8px 0;
            font-size: 1rem;
            font-weight: 500;
            color: #0f172a;
            cursor: pointer;
        }

        .competencia-picker select:focus {
            outline: none;
        }

        .competencia-picker button {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 40px;
            padding: 8px 16px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .competencia-picker button:hover {
            background: #f1f5f9;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>‚è∞ Banco de Horas</h2>
            </div>
            <ul class="sidebar-nav">
                <li onclick="showTab('dashboard')">
                    <span>üìä</span> Dashboard
                </li>
                <li onclick="showTab('colaboradores')">
                    <span>üë•</span> Colaboradores
                </li>
                <li class="active" onclick="showTab('lancamentos')">
                    <span>‚è±Ô∏è</span> Banco de Horas
                </li>
                <li onclick="showTab('configuracoes')">
                    <span>‚öôÔ∏è</span> Configura√ß√µes
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="page-header">
                <h1>Banco de Horas</h1>
                <div class="user-info">
                    <span>Admin</span>
                    <div class="user-avatar">A</div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">üë•</div>
                            <div>
                                <div class="stat-title">Total Colaboradores</div>
                                <div class="stat-value" id="totalColaboradores">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">‚ûï</div>
                            <div>
                                <div class="stat-title">Horas Positivas</div>
                                <div class="stat-value" id="totalHorasPositivas">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon red">‚ûñ</div>
                            <div>
                                <div class="stat-title">Horas Negativas</div>
                                <div class="stat-value" id="totalHorasNegativas">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon purple">‚öñÔ∏è</div>
                            <div>
                                <div class="stat-title">Saldo L√≠quido</div>
                                <div class="stat-value" id="saldoLiquido">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <h3 style="margin-bottom: 20px;">√öltimos Lan√ßamentos</h3>
                    <div id="recentActivities">
                        <!-- Atividades ser√£o inseridas aqui -->
                    </div>
                </div>
            </div>

            <!-- Colaboradores Tab -->
            <div id="colaboradores" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="color: #0f172a;">üë• Colaboradores</h2>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="showImportModal()">
                            üì• Importar
                        </button>
                        <button class="btn btn-primary" onclick="showColaboradorModal()">
                            + Novo Colaborador
                        </button>
                    </div>
                </div>

                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Buscar</label>
                        <input type="text" id="searchColaborador" placeholder="Nome, departamento ou empresa..." onkeyup="filterColaboradores()">
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="filterStatus" onchange="filterColaboradores()">
                            <option value="ativos">Ativos</option>
                            <option value="todos">Todos</option>
                            <option value="inativos">Inativos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Departamento</label>
                        <select id="filterDepartamento" onchange="filterColaboradores()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Empresa</label>
                        <select id="filterEmpresa" onchange="filterColaboradores()">
                            <option value="">Todas</option>
                        </select>
                    </div>
                </div>

                <div id="importAlert" class="alert hidden"></div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortColaboradores('nome')">Nome üìä</th>
                                <th onclick="sortColaboradores('dataAdmissao')">Admiss√£o üìä</th>
                                <th onclick="sortColaboradores('departamento')">Departamento üìä</th>
                                <th onclick="sortColaboradores('empresa')">Empresa üìä</th>
                                <th>Saldo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="colaboradoresList">
                            <!-- Colaboradores ser√£o inseridos aqui -->
                        </tbody>
                    </table>

                    <div class="pagination" id="pagination" style="margin-top: 20px; display: flex; justify-content: center; gap: 8px;">
                        <!-- Pagina√ß√£o -->
                    </div>
                </div>
            </div>

            <!-- Lan√ßamentos Tab - NOVO LAYOUT IGUAL √Ä IMAGEM -->
            <div id="lancamentos" class="tab-content active">
                <div style="max-width: 800px; margin: 0 auto;">
                    <!-- Card de Novo Lan√ßamento igual √† imagem -->
                    <div class="lancamento-card">
                        <div class="lancamento-header">
                            <h2># Novo Lan√ßamento</h2>
                            <p>Registre horas extras ou d√©bitos</p>
                        </div>

                        <form id="lancamentoForm" onsubmit="event.preventDefault(); saveLancamento();">
                            <div class="lancamento-field">
                                <label>Funcion√°rio *</label>
                                <select id="lancamentoColaborador" required>
                                    <option value="">Selecione um funcion√°rio ‚ñº</option>
                                </select>
                            </div>

                            <div class="lancamento-field">
                                <label>Tipo *</label>
                                <select id="lancamentoTipo" required>
                                    <option value="positiva">Hora Extra (Positiva)</option>
                                    <option value="negativa">D√©bito (Negativa)</option>
                                </select>
                            </div>

                            <div class="lancamento-field">
                                <label>Quantidade (HH:MM) *</label>
                                <input type="text" id="lancamentoHoras" placeholder="08:30" required>
                                <span class="format-hint">
                                    <i>‚ìò</i> formato HH:MM (ex: 08:30)
                                </span>
                            </div>

                            <div class="lancamento-field">
                                <label>Compet√™ncia *</label>
                                <div class="competencia-picker">
                                    <select id="lancamentoMes" required>
                                        <option value="01">Janeiro</option>
                                        <option value="02">Fevereiro</option>
                                        <option value="03">Mar√ßo</option>
                                        <option value="04">Abril</option>
                                        <option value="05">Maio</option>
                                        <option value="06">Junho</option>
                                        <option value="07">Julho</option>
                                        <option value="08">Agosto</option>
                                        <option value="09">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>
                                    <select id="lancamentoAno" required>
                                        <!-- Anos ser√£o preenchidos -->
                                    </select>
                                    <button type="button">‚ñ∂</button>
                                </div>
                            </div>

                            <div class="lancamento-field">
                                <label>Descri√ß√£o</label>
                                <textarea id="lancamentoDescricao" rows="3" placeholder="Motivo do lan√ßamento..."></textarea>
                            </div>

                            <div class="lancamento-actions">
                                <button type="button" class="btn-lancamento btn-cancel" onclick="hideModal('lancamentoModal')">Cancelar</button>
                                <button type="submit" class="btn-lancamento btn-save">Salvar Lan√ßamento</button>
                            </div>
                        </form>
                    </div>

                    <!-- Filtros e Listagem de Lan√ßamentos -->
                    <div style="margin-top: 40px;">
                        <div class="filters-bar">
                            <div class="filter-group">
                                <label>Filtrar por Colaborador</label>
                                <select id="filtroColaborador" onchange="filtrarLancamentos()">
                                    <option value="">-- Selecione --</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>M√™s/Ano</label>
                                <div style="display: flex; gap: 8px;">
                                    <select id="filtroMes" onchange="filtrarLancamentos()">
                                        <option value="01">Janeiro</option>
                                        <option value="02">Fevereiro</option>
                                        <option value="03">Mar√ßo</option>
                                        <option value="04">Abril</option>
                                        <option value="05">Maio</option>
                                        <option value="06">Junho</option>
                                        <option value="07">Julho</option>
                                        <option value="08">Agosto</option>
                                        <option value="09">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>
                                    <select id="filtroAno" onchange="filtrarLancamentos()">
                                        <!-- Anos -->
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="limparFiltros()">Limpar</button>
                        </div>

                        <!-- Resumo do per√≠odo -->
                        <div id="resumoMensal" class="dashboard-grid" style="margin-bottom: 24px; display: none;">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon green">‚ûï</div>
                                    <div>
                                        <div class="stat-title">Horas Positivas</div>
                                        <div class="stat-value" id="resumoPositivas">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon red">‚ûñ</div>
                                    <div>
                                        <div class="stat-title">Horas Negativas</div>
                                        <div class="stat-value" id="resumoNegativas">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-icon purple">‚öñÔ∏è</div>
                                    <div>
                                        <div class="stat-title">Saldo do M√™s</div>
                                        <div class="stat-value" id="resumoSaldo">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela de Lan√ßamentos -->
                        <div class="table-container">
                            <div id="semSelecaoMsg" style="text-align: center; padding: 40px; color: #64748b;">
                                üëÜ Selecione um colaborador e per√≠odo para visualizar os lan√ßamentos
                            </div>
                            <table id="lancamentosTable" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Tipo</th>
                                        <th>Quantidade</th>
                                        <th>Descri√ß√£o</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="lancamentosList">
                                    <!-- Lan√ßamentos -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes Tab -->
            <div id="configuracoes" class="tab-content">
                <h2 style="color: #0f172a; margin-bottom: 24px;">‚öôÔ∏è Configura√ß√µes</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Empresas -->
                    <div class="table-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Empresas</h3>
                            <button class="btn btn-primary" onclick="showEmpresaModal()">+ Nova</button>
                        </div>
                        <div id="empresasAlert" class="alert alert-info hidden">Nenhuma empresa cadastrada.</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th style="width: 100px;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="empresasList"></tbody>
                        </table>
                    </div>

                    <!-- Departamentos -->
                    <div class="table-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Departamentos</h3>
                            <button class="btn btn-primary" onclick="showDepartamentoModal()">+ Novo</button>
                        </div>
                        <div id="departamentosAlert" class="alert alert-info hidden">Nenhum departamento cadastrado.</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th style="width: 100px;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="departamentosList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais (mantidos os mesmos) -->
    <div id="colaboradorModal" class="modal">
        <div class="modal-content">
            <h2 id="colaboradorModalTitle">Novo Colaborador</h2>
            <form id="colaboradorForm" onsubmit="event.preventDefault(); saveColaborador();">
                <input type="hidden" id="colaboradorId">
                <div class="form-group">
                    <label>Nome Completo:</label>
                    <input type="text" id="colaboradorNome" required>
                </div>
                <div class="form-group">
                    <label>Data de Admiss√£o:</label>
                    <input type="text" id="colaboradorData" placeholder="DD/MM/AAAA" required>
                </div>
                <div class="form-group">
                    <label>Departamento:</label>
                    <select id="colaboradorDepartamento" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Empresa:</label>
                    <select id="colaboradorEmpresa" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
                    <input type="checkbox" id="colaboradorAtivo" checked style="width: 18px; height: 18px;">
                    <label for="colaboradorAtivo" style="color: #334155;">Colaborador Ativo</label>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('colaboradorModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="lancamentoModal" class="modal">
        <div class="modal-content">
            <h2>Novo Lan√ßamento</h2>
            <form id="lancamentoModalForm" onsubmit="event.preventDefault(); saveLancamento();">
                <div class="form-group">
                    <label>Colaborador:</label>
                    <select id="lancamentoColaboradorModal" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="lancamentoTipoModal" required>
                        <option value="positiva">Hora Positiva (Extra)</option>
                        <option value="negativa">Hora Negativa (D√©bito)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade (HH:MM):</label>
                    <input type="text" id="lancamentoHorasModal" placeholder="08:30" required>
                </div>
                <div class="form-group">
                    <label>Compet√™ncia:</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="lancamentoMesModal" required style="flex: 1;">
                            <option value="01">Janeiro</option>
                            <option value="02">Fevereiro</option>
                            <option value="03">Mar√ßo</option>
                            <option value="04">Abril</option>
                            <option value="05">Maio</option>
                            <option value="06">Junho</option>
                            <option value="07">Julho</option>
                            <option value="08">Agosto</option>
                            <option value="09">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                        <select id="lancamentoAnoModal" required style="flex: 1;">
                            <!-- Anos -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o:</label>
                    <textarea id="lancamentoDescricaoModal" rows="3"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('lancamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="empresaModal" class="modal">
        <div class="modal-content">
            <h2 id="empresaModalTitle">Nova Empresa</h2>
            <form id="empresaForm" onsubmit="event.preventDefault(); saveEmpresa();">
                <input type="hidden" id="empresaId">
                <input type="hidden" id="empresaNomeOriginal">
                <div class="form-group">
                    <label>Nome da Empresa:</label>
                    <input type="text" id="empresaNome" required>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('empresaModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="departamentoModal" class="modal">
        <div class="modal-content">
            <h2 id="departamentoModalTitle">Novo Departamento</h2>
            <form id="departamentoForm" onsubmit="event.preventDefault(); saveDepartamento();">
                <input type="hidden" id="departamentoId">
                <input type="hidden" id="departamentoNomeOriginal">
                <div class="form-group">
                    <label>Nome do Departamento:</label>
                    <input type="text" id="departamentoNome" required>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('departamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="importModal" class="modal">
        <div class="modal-content">
            <h2>Importar Planilha</h2>
            <div style="margin-bottom: 20px;">
                <div style="background: #f8fafc; border-radius: 16px; padding: 16px; margin-bottom: 16px;">
                    <h4 style="margin-bottom: 8px;">üìã Modelo da Planilha</h4>
                    <p style="font-size: 0.9rem; color: #475569;">Formato: Nome, Data Admiss√£o (DD/MM/AAAA), Departamento, Empresa</p>
                    <pre style="background: white; padding: 12px; border-radius: 8px; margin: 12px 0; font-size: 0.85rem;">
Jo√£o Silva,01/01/2023,TI,Empresa A
Maria Santos,15/03/2023,RH,Empresa B</pre>
                </div>
                
                <div class="form-group">
                    <label>Cole os dados:</label>
                    <textarea id="importData" rows="6" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px;"></textarea>
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button type="button" class="btn btn-secondary" onclick="hideModal('importModal')">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="importColaboradores()">Importar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDY6qtn4JJPXggiswJjUZCt866oycv_LHk",
            authDomain: "gestao-de-banco-de-horas.firebaseapp.com",
            projectId: "gestao-de-banco-de-horas",
            storageBucket: "gestao-de-banco-de-horas.firebasestorage.app",
            messagingSenderId: "1071713106694",
            appId: "1:1071713106694:web:0a164293419ba46b6e7c87"
        };

        // Initialize Firebase
        let app;
        let db;
        let firebaseConnected = false;

        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            const settings = { timestampsInSnapshots: true };
            db.settings(settings);
            
            db.collection('test').limit(1).get()
                .then(() => {
                    firebaseConnected = true;
                    loadData();
                })
                .catch((error) => {
                    console.error('Erro ao testar conex√£o:', error);
                    firebaseConnected = false;
                });
        } catch (error) {
            console.error('Erro ao inicializar Firebase:', error);
            firebaseConnected = false;
        }

        // Vari√°veis globais
        let colaboradores = [];
        let lancamentos = [];
        let empresas = [];
        let empresasDocs = [];
        let departamentos = [];
        let departamentosDocs = [];
        
        let colaboradoresFiltrados = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let sortField = 'nome';
        let sortDirection = 'asc';

        // Fun√ß√µes utilit√°rias
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.sidebar-nav li').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (tabName === 'lancamentos') {
                atualizarSelectColaboradores();
            }
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Fun√ß√µes para modais
        function showColaboradorModal(editId = null) {
            if (!firebaseConnected) {
                alert('Sem conex√£o com o Firebase.');
                return;
            }
            
            if (empresas.length === 0 || departamentos.length === 0) {
                alert('Cadastre empresas e departamentos primeiro!');
                showTab('configuracoes');
                return;
            }
            
            loadSelects();
            document.getElementById('colaboradorModal').style.display = 'block';
            
            if (editId) {
                document.getElementById('colaboradorModalTitle').textContent = 'Editar Colaborador';
                const colab = colaboradores.find(c => c.id === editId);
                if (colab) {
                    document.getElementById('colaboradorId').value = colab.id;
                    document.getElementById('colaboradorNome').value = colab.nome;
                    document.getElementById('colaboradorData').value = colab.dataAdmissao;
                    document.getElementById('colaboradorDepartamento').value = colab.departamento;
                    document.getElementById('colaboradorEmpresa').value = colab.empresa;
                    document.getElementById('colaboradorAtivo').checked = colab.ativo !== false;
                }
            } else {
                document.getElementById('colaboradorModalTitle').textContent = 'Novo Colaborador';
                document.getElementById('colaboradorId').value = '';
                document.getElementById('colaboradorForm').reset();
                document.getElementById('colaboradorAtivo').checked = true;
            }
        }

        function showLancamentoModal() {
            if (!firebaseConnected) {
                alert('Sem conex√£o com o Firebase.');
                return;
            }
            if (colaboradores.length === 0) {
                alert('Cadastre colaboradores primeiro!');
                return;
            }
            document.getElementById('lancamentoModal').style.display = 'block';
            loadColaboradoresSelectModal();
        }

        function showEmpresaModal(editNome = null) {
            document.getElementById('empresaModal').style.display = 'block';
            if (editNome) {
                document.getElementById('empresaModalTitle').textContent = 'Editar Empresa';
                document.getElementById('empresaNome').value = editNome;
                document.getElementById('empresaNomeOriginal').value = editNome;
                const empresaDoc = empresasDocs.find(doc => doc.nome === editNome);
                if (empresaDoc) {
                    document.getElementById('empresaId').value = empresaDoc.id;
                }
            } else {
                document.getElementById('empresaModalTitle').textContent = 'Nova Empresa';
                document.getElementById('empresaId').value = '';
                document.getElementById('empresaNomeOriginal').value = '';
                document.getElementById('empresaNome').value = '';
            }
        }

        function showDepartamentoModal(editNome = null) {
            document.getElementById('departamentoModal').style.display = 'block';
            if (editNome) {
                document.getElementById('departamentoModalTitle').textContent = 'Editar Departamento';
                document.getElementById('departamentoNome').value = editNome;
                document.getElementById('departamentoNomeOriginal').value = editNome;
                const deptoDoc = departamentosDocs.find(doc => doc.nome === editNome);
                if (deptoDoc) {
                    document.getElementById('departamentoId').value = deptoDoc.id;
                }
            } else {
                document.getElementById('departamentoModalTitle').textContent = 'Novo Departamento';
                document.getElementById('departamentoId').value = '';
                document.getElementById('departamentoNomeOriginal').value = '';
                document.getElementById('departamentoNome').value = '';
            }
        }

        function showImportModal() {
            document.getElementById('importModal').style.display = 'block';
        }

        // Fun√ß√£o para converter HH:MM para horas decimais
        function horaParaDecimal(horaStr) {
            const [horas, minutos] = horaStr.split(':').map(Number);
            return horas + (minutos / 60);
        }

        // Fun√ß√£o para validar formato HH:MM
        function isValidHora(horaStr) {
            const regex = /^([0-9]{1,2}):([0-9]{2})$/;
            if (!regex.test(horaStr)) return false;
            const [horas, minutos] = horaStr.split(':').map(Number);
            return horas >= 0 && horas < 100 && minutos >= 0 && minutos < 60;
        }

        // Fun√ß√£o para validar data
        function isValidDate(dateStr) {
            const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            if (!regex.test(dateStr)) return false;
            const [_, dia, mes, ano] = dateStr.match(regex);
            const data = new Date(ano, mes - 1, dia);
            return data.getDate() == dia && data.getMonth() == mes - 1;
        }

        // Carregar dados do Firebase
        async function loadData() {
            if (!firebaseConnected) {
                showLoading(false);
                return;
            }
            
            showLoading(true);
            try {
                // Carregar empresas
                const empresasSnapshot = await db.collection('empresas').get();
                empresasDocs = empresasSnapshot.docs.map(doc => ({
                    id: doc.id,
                    nome: doc.data().nome
                }));
                empresas = empresasDocs.map(doc => doc.nome);

                // Carregar departamentos
                const departamentosSnapshot = await db.collection('departamentos').get();
                departamentosDocs = departamentosSnapshot.docs.map(doc => ({
                    id: doc.id,
                    nome: doc.data().nome
                }));
                departamentos = departamentosDocs.map(doc => doc.nome);

                // Carregar colaboradores
                const colaboradoresSnapshot = await db.collection('colaboradores').get();
                colaboradores = colaboradoresSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                colaboradores.sort((a, b) => a.nome.localeCompare(b.nome));

                // Carregar lan√ßamentos
                const lancamentosSnapshot = await db.collection('lancamentos').orderBy('data', 'desc').get();
                lancamentos = lancamentosSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Calcular saldos
                calcularSaldos();

                updateAllTables();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                alert('Erro ao carregar dados: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function calcularSaldos() {
            colaboradores.forEach(colab => {
                colab.horasPositivas = 0;
                colab.horasNegativas = 0;
            });

            lancamentos.forEach(lanc => {
                const colaborador = colaboradores.find(c => c.id === lanc.colaboradorId);
                if (colaborador) {
                    if (lanc.tipo === 'positiva') {
                        colaborador.horasPositivas = (colaborador.horasPositivas || 0) + lanc.horas;
                    } else {
                        colaborador.horasNegativas = (colaborador.horasNegativas || 0) + lanc.horas;
                    }
                }
            });
        }

        // Preencher selects
        function preencherAnos() {
            const anoAtual = new Date().getFullYear();
            const anos = [];
            for (let i = anoAtual - 2; i <= anoAtual + 1; i++) {
                anos.push(i);
            }
            
            const selects = ['filtroAno', 'lancamentoAno', 'lancamentoAnoModal'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '';
                    anos.forEach(ano => {
                        const option = document.createElement('option');
                        option.value = ano;
                        option.textContent = ano;
                        if (ano === anoAtual) option.selected = true;
                        select.appendChild(option);
                    });
                }
            });
        }

        function loadSelects() {
            const deptoSelect = document.getElementById('colaboradorDepartamento');
            const empresaSelect = document.getElementById('colaboradorEmpresa');
            
            deptoSelect.innerHTML = '<option value="">Selecione...</option>';
            empresaSelect.innerHTML = '<option value="">Selecione...</option>';
            
            departamentos.sort().forEach(depto => {
                deptoSelect.innerHTML += `<option value="${depto}">${depto}</option>`;
            });
            
            empresas.sort().forEach(empresa => {
                empresaSelect.innerHTML += `<option value="${empresa}">${empresa}</option>`;
            });
        }

        function loadColaboradoresSelect() {
            const select = document.getElementById('lancamentoColaborador');
            select.innerHTML = '<option value="">Selecione um funcion√°rio ‚ñº</option>';
            colaboradores
                .filter(c => c.ativo !== false)
                .forEach(colab => {
                    select.innerHTML += `<option value="${colab.id}">${colab.nome}</option>`;
                });
        }

        function loadColaboradoresSelectModal() {
            const select = document.getElementById('lancamentoColaboradorModal');
            select.innerHTML = '<option value="">Selecione...</option>';
            colaboradores
                .filter(c => c.ativo !== false)
                .forEach(colab => {
                    select.innerHTML += `<option value="${colab.id}">${colab.nome}</option>`;
                });
        }

        function atualizarSelectColaboradores() {
            const select = document.getElementById('filtroColaborador');
            select.innerHTML = '<option value="">-- Selecione --</option>';
            colaboradores
                .filter(c => c.ativo !== false)
                .forEach(colab => {
                    select.innerHTML += `<option value="${colab.id}">${colab.nome}</option>`;
                });
        }

        // Fun√ß√µes CRUD
        async function saveEmpresa() {
            const id = document.getElementById('empresaId').value;
            const nome = document.getElementById('empresaNome').value.trim();
            const nomeOriginal = document.getElementById('empresaNomeOriginal').value;

            if (!nome) {
                alert('Digite um nome para a empresa');
                return;
            }

            if ((!id || nome !== nomeOriginal) && empresas.includes(nome)) {
                alert('Esta empresa j√° est√° cadastrada!');
                return;
            }

            showLoading(true);
            try {
                if (id) {
                    await db.collection('empresas').doc(id).update({ 
                        nome,
                        updatedAt: new Date().toISOString()
                    });
                    
                    if (nome !== nomeOriginal) {
                        const colaboradoresEmpresa = colaboradores.filter(c => c.empresa === nomeOriginal);
                        for (const colab of colaboradoresEmpresa) {
                            await db.collection('colaboradores').doc(colab.id).update({
                                empresa: nome,
                                updatedAt: new Date().toISOString()
                            });
                        }
                    }
                } else {
                    await db.collection('empresas').add({ 
                        nome,
                        createdAt: new Date().toISOString()
                    });
                }
                
                await loadData();
                hideModal('empresaModal');
            } catch (error) {
                console.error('Erro ao salvar empresa:', error);
                alert('Erro ao salvar: ' + error.message);
            }
            showLoading(false);
        }

        async function saveDepartamento() {
            const id = document.getElementById('departamentoId').value;
            const nome = document.getElementById('departamentoNome').value.trim();
            const nomeOriginal = document.getElementById('departamentoNomeOriginal').value;

            if (!nome) {
                alert('Digite um nome para o departamento');
                return;
            }

            if ((!id || nome !== nomeOriginal) && departamentos.includes(nome)) {
                alert('Este departamento j√° est√° cadastrado!');
                return;
            }

            showLoading(true);
            try {
                if (id) {
                    await db.collection('departamentos').doc(id).update({ 
                        nome,
                        updatedAt: new Date().toISOString()
                    });
                    
                    if (nome !== nomeOriginal) {
                        const colaboradoresDepto = colaboradores.filter(c => c.departamento === nomeOriginal);
                        for (const colab of colaboradoresDepto) {
                            await db.collection('colaboradores').doc(colab.id).update({
                                departamento: nome,
                                updatedAt: new Date().toISOString()
                            });
                        }
                    }
                } else {
                    await db.collection('departamentos').add({ 
                        nome,
                        createdAt: new Date().toISOString()
                    });
                }
                
                await loadData();
                hideModal('departamentoModal');
            } catch (error) {
                console.error('Erro ao salvar departamento:', error);
                alert('Erro ao salvar: ' + error.message);
            }
            showLoading(false);
        }

        async function saveColaborador() {
            const id = document.getElementById('colaboradorId').value;
            const nome = document.getElementById('colaboradorNome').value.trim();
            const data = document.getElementById('colaboradorData').value;
            const departamento = document.getElementById('colaboradorDepartamento').value;
            const empresa = document.getElementById('colaboradorEmpresa').value;
            const ativo = document.getElementById('colaboradorAtivo').checked;

            if (!nome || !data || !departamento || !empresa) {
                alert('Preencha todos os campos!');
                return;
            }

            if (!isValidDate(data)) {
                alert('Data inv√°lida! Use o formato DD/MM/AAAA');
                return;
            }

            showLoading(true);
            try {
                const colaboradorData = {
                    nome,
                    dataAdmissao: data,
                    departamento,
                    empresa,
                    horasPositivas: 0,
                    horasNegativas: 0,
                    ativo,
                    updatedAt: new Date().toISOString()
                };

                if (id) {
                    await db.collection('colaboradores').doc(id).update(colaboradorData);
                } else {
                    colaboradorData.createdAt = new Date().toISOString();
                    await db.collection('colaboradores').add(colaboradorData);
                }

                await loadData();
                hideModal('colaboradorModal');
            } catch (error) {
                console.error('Erro ao salvar colaborador:', error);
                alert('Erro ao salvar: ' + error.message);
            }
            showLoading(false);
        }

        async function saveLancamento() {
            // Pega os valores do formul√°rio principal (igual √† imagem)
            const colaboradorId = document.getElementById('lancamentoColaborador').value;
            const tipo = document.getElementById('lancamentoTipo').value;
            const horaStr = document.getElementById('lancamentoHoras').value;
            const mes = document.getElementById('lancamentoMes').value;
            const ano = document.getElementById('lancamentoAno').value;
            const descricao = document.getElementById('lancamentoDescricao').value.trim();

            if (!colaboradorId || !tipo || !horaStr || !mes || !ano) {
                alert('Preencha todos os campos obrigat√≥rios!');
                return;
            }

            if (!isValidHora(horaStr)) {
                alert('Formato de hora inv√°lido! Use HH:MM (ex: 08:30)');
                return;
            }

            const horas = horaParaDecimal(horaStr);
            if (horas <= 0) {
                alert('A quantidade de horas deve ser maior que zero!');
                return;
            }

            const colaborador = colaboradores.find(c => c.id === colaboradorId);
            if (!colaborador) return;

            // Data no formato DD/MM/AAAA (primeiro dia do m√™s)
            const data = `01/${mes}/${ano}`;

            showLoading(true);
            try {
                const lancamentoData = {
                    colaboradorId,
                    colaboradorNome: colaborador.nome,
                    data,
                    mes,
                    ano,
                    tipo,
                    horas,
                    descricao: descricao || 'Sem descri√ß√£o',
                    createdAt: new Date().toISOString()
                };

                await db.collection('lancamentos').add(lancamentoData);
                await loadData();
                
                // Limpar formul√°rio
                document.getElementById('lancamentoHoras').value = '';
                document.getElementById('lancamentoDescricao').value = '';
                
                // Atualizar visualiza√ß√£o se filtro estiver ativo
                const filtroColab = document.getElementById('filtroColaborador').value;
                const filtroMes = document.getElementById('filtroMes').value;
                const filtroAno = document.getElementById('filtroAno').value;
                
                if (filtroColab === colaboradorId && filtroMes === mes && filtroAno === ano) {
                    filtrarLancamentos();
                }
                
                alert('Lan√ßamento realizado com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar lan√ßamento:', error);
                alert('Erro ao salvar: ' + error.message);
            }
            showLoading(false);
        }

        async function importColaboradores() {
            const data = document.getElementById('importData').value;
            const lines = data.split('\n');
            let imported = 0;
            let errors = 0;

            showLoading(true);
            try {
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const [nome, dataAdmissao, departamento, empresa] = line.split(',').map(item => item.trim());
                        
                        if (nome && dataAdmissao && departamento && empresa) {
                            if (!departamentos.includes(departamento)) {
                                errors++;
                                continue;
                            }
                            
                            if (!empresas.includes(empresa)) {
                                errors++;
                                continue;
                            }
                            
                            if (isValidDate(dataAdmissao)) {
                                await db.collection('colaboradores').add({
                                    nome,
                                    dataAdmissao,
                                    departamento,
                                    empresa,
                                    horasPositivas: 0,
                                    horasNegativas: 0,
                                    ativo: true,
                                    createdAt: new Date().toISOString()
                                });
                                imported++;
                            } else {
                                errors++;
                            }
                        } else {
                            errors++;
                        }
                    }
                }

                await loadData();
                alert(`${imported} colaborador(es) importado(s) com sucesso! ${errors} erro(s).`);
                hideModal('importModal');
            } catch (error) {
                console.error('Erro ao importar:', error);
                alert('Erro ao importar: ' + error.message);
            }
            showLoading(false);
        }

        // Fun√ß√µes de filtro
        function filterColaboradores() {
            const searchTerm = document.getElementById('searchColaborador').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const deptoFilter = document.getElementById('filterDepartamento').value;
            const empresaFilter = document.getElementById('filterEmpresa').value;

            colaboradoresFiltrados = colaboradores.filter(colab => {
                const matchSearch = colab.nome.toLowerCase().includes(searchTerm) ||
                                  colab.departamento.toLowerCase().includes(searchTerm) ||
                                  colab.empresa.toLowerCase().includes(searchTerm);
                const matchDepto = !deptoFilter || colab.departamento === deptoFilter;
                const matchEmpresa = !empresaFilter || colab.empresa === empresaFilter;
                
                let matchStatus = true;
                if (statusFilter === 'ativos') {
                    matchStatus = colab.ativo !== false;
                } else if (statusFilter === 'inativos') {
                    matchStatus = colab.ativo === false;
                }
                
                return matchSearch && matchDepto && matchEmpresa && matchStatus;
            });

            sortColaboradores(sortField);
            currentPage = 1;
            updateColaboradoresTable();
        }

        function sortColaboradores(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }

            colaboradoresFiltrados.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                
                if (field === 'dataAdmissao') {
                    const [dA, mA, yA] = valA.split('/');
                    const [dB, mB, yB] = valB.split('/');
                    valA = new Date(yA, mA - 1, dA);
                    valB = new Date(yB, mB - 1, dB);
                } else {
                    valA = String(valA || '').toLowerCase();
                    valB = String(valB || '').toLowerCase();
                }
                
                if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            updateColaboradoresTable();
        }

        function filtrarLancamentos() {
            const colaboradorId = document.getElementById('filtroColaborador').value;
            const mes = document.getElementById('filtroMes').value;
            const ano = document.getElementById('filtroAno').value;
            
            const resumoDiv = document.getElementById('resumoMensal');
            const tabela = document.getElementById('lancamentosTable');
            const semSelecaoMsg = document.getElementById('semSelecaoMsg');
            
            if (!colaboradorId) {
                resumoDiv.style.display = 'none';
                tabela.style.display = 'none';
                semSelecaoMsg.style.display = 'block';
                return;
            }
            
            const lancamentosFiltrados = lancamentos.filter(lanc => {
                if (lanc.colaboradorId !== colaboradorId) return false;
                const partes = lanc.data.split('/');
                if (partes.length !== 3) return false;
                const lancMes = partes[1];
                const lancAno = partes[2];
                return lancMes === mes && lancAno === ano;
            });
            
            let totalPositivas = 0;
            let totalNegativas = 0;
            
            lancamentosFiltrados.forEach(lanc => {
                if (lanc.tipo === 'positiva') {
                    totalPositivas += lanc.horas;
                } else {
                    totalNegativas += lanc.horas;
                }
            });
            
            const saldo = totalPositivas - totalNegativas;
            
            document.getElementById('resumoPositivas').textContent = totalPositivas.toFixed(1);
            document.getElementById('resumoNegativas').textContent = totalNegativas.toFixed(1);
            document.getElementById('resumoSaldo').textContent = saldo.toFixed(1);
            
            const tbody = document.getElementById('lancamentosList');
            tbody.innerHTML = '';
            
            if (lancamentosFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">Nenhum lan√ßamento encontrado.</td></tr>';
            } else {
                lancamentosFiltrados.sort((a, b) => {
                    const [dA, mA, yA] = a.data.split('/');
                    const [dB, mB, yB] = b.data.split('/');
                    const dataA = new Date(yA, mA - 1, dA);
                    const dataB = new Date(yB, mB - 1, dB);
                    return dataB - dataA;
                });
                
                lancamentosFiltrados.forEach(lanc => {
                    const tipoClass = lanc.tipo === 'positiva' ? 'badge-success' : 'badge-danger';
                    const tipoText = lanc.tipo === 'positiva' ? 'Extra' : 'D√©bito';
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${lanc.data}</td>
                            <td><span class="badge ${tipoClass}">${tipoText}</span></td>
                            <td>${lanc.horas} h</td>
                            <td>${lanc.descricao || '-'}</td>
                            <td>
                                <button class="btn btn-danger" style="padding: 6px 12px;" onclick="deleteLancamento('${lanc.id}')">Excluir</button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            resumoDiv.style.display = 'grid';
            tabela.style.display = 'table';
            semSelecaoMsg.style.display = 'none';
        }

        function limparFiltros() {
            document.getElementById('filtroColaborador').value = '';
            const anoAtual = new Date().getFullYear().toString();
            document.getElementById('filtroMes').value = '01';
            document.getElementById('filtroAno').value = anoAtual;
            
            document.getElementById('resumoMensal').style.display = 'none';
            document.getElementById('lancamentosTable').style.display = 'none';
            document.getElementById('semSelecaoMsg').style.display = 'block';
        }

        // Deletar fun√ß√µes
        async function deleteColaborador(id) {
            const colaborador = colaboradores.find(c => c.id === id);
            if (!colaborador) return;

            if (confirm(`Excluir "${colaborador.nome}"?`)) {
                showLoading(true);
                try {
                    const lancamentosRelacionados = lancamentos.filter(l => l.colaboradorId === id);
                    for (const lanc of lancamentosRelacionados) {
                        await db.collection('lancamentos').doc(lanc.id).delete();
                    }
                    
                    await db.collection('colaboradores').doc(id).delete();
                    await loadData();
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteEmpresa(nome) {
            const colaboradoresNaEmpresa = colaboradores.filter(c => c.empresa === nome);
            if (colaboradoresNaEmpresa.length > 0) {
                alert(`Existem ${colaboradoresNaEmpresa.length} colaborador(es) vinculados.`);
                return;
            }

            if (confirm(`Excluir empresa "${nome}"?`)) {
                showLoading(true);
                try {
                    const empresaDoc = empresasDocs.find(doc => doc.nome === nome);
                    if (empresaDoc) {
                        await db.collection('empresas').doc(empresaDoc.id).delete();
                        await loadData();
                    }
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteDepartamento(nome) {
            const colaboradoresNoDepto = colaboradores.filter(c => c.departamento === nome);
            if (colaboradoresNoDepto.length > 0) {
                alert(`Existem ${colaboradoresNoDepto.length} colaborador(es) vinculados.`);
                return;
            }

            if (confirm(`Excluir departamento "${nome}"?`)) {
                showLoading(true);
                try {
                    const deptoDoc = departamentosDocs.find(doc => doc.nome === nome);
                    if (deptoDoc) {
                        await db.collection('departamentos').doc(deptoDoc.id).delete();
                        await loadData();
                    }
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteLancamento(id) {
            if (confirm('Excluir este lan√ßamento?')) {
                showLoading(true);
                try {
                    await db.collection('lancamentos').doc(id).delete();
                    await loadData();
                    
                    const filtroColab = document.getElementById('filtroColaborador').value;
                    const filtroMes = document.getElementById('filtroMes').value;
                    const filtroAno = document.getElementById('filtroAno').value;
                    
                    if (filtroColab && filtroMes && filtroAno) {
                        filtrarLancamentos();
                    }
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar: ' + error.message);
                }
                showLoading(false);
            }
        }

        // Atualizar tabelas
        function updateAllTables() {
            updateFilterOptions();
            colaboradoresFiltrados = [...colaboradores].filter(c => c.ativo !== false);
            sortColaboradores('nome');
            updateEmpresasTable();
            updateDepartamentosTable();
            updateDashboard();
            loadColaboradoresSelect();
            atualizarSelectColaboradores();
            preencherAnos();
        }

        function updateFilterOptions() {
            const deptoSelect = document.getElementById('filterDepartamento');
            const empresaSelect = document.getElementById('filterEmpresa');
            
            deptoSelect.innerHTML = '<option value="">Todos</option>';
            empresaSelect.innerHTML = '<option value="">Todas</option>';
            
            const deptosUnicos = [...new Set(colaboradores.map(c => c.departamento))];
            deptosUnicos.sort().forEach(depto => {
                deptoSelect.innerHTML += `<option value="${depto}">${depto}</option>`;
            });
            
            const empresasUnicas = [...new Set(colaboradores.map(c => c.empresa))];
            empresasUnicas.sort().forEach(empresa => {
                empresaSelect.innerHTML += `<option value="${empresa}">${empresa}</option>`;
            });
        }

        function updateColaboradoresTable() {
            const tbody = document.getElementById('colaboradoresList');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedColabs = colaboradoresFiltrados.slice(start, end);

            tbody.innerHTML = '';

            if (colaboradoresFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhum colaborador encontrado.</td></tr>';
                updatePagination();
                return;
            }

            paginatedColabs.forEach(colab => {
                const saldo = (colab.horasPositivas || 0) - (colab.horasNegativas || 0);
                const statusClass = saldo >= 0 ? 'badge-success' : 'badge-danger';
                const statusText = colab.ativo !== false ? 
                    '<span class="badge badge-success">Ativo</span>' : 
                    '<span class="badge badge-danger">Inativo</span>';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${colab.nome}</td>
                        <td>${colab.dataAdmissao}</td>
                        <td>${colab.departamento}</td>
                        <td>${colab.empresa}</td>
                        <td><span class="badge ${statusClass}">${saldo.toFixed(1)}h</span></td>
                        <td>${statusText}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 6px 12px; margin-right: 4px;" onclick="showColaboradorModal('${colab.id}')">Editar</button>
                            <button class="btn btn-danger" style="padding: 6px 12px;" onclick="deleteColaborador('${colab.id}')">Excluir</button>
                        </td>
                    </tr>
                `;
            });

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(colaboradoresFiltrados.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="btn ${i === currentPage ? 'btn-primary' : 'btn-secondary'}" style="padding: 8px 12px;" onclick="goToPage(${i})">${i}</button>`;
            }
            pagination.innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            updateColaboradoresTable();
        }

        function updateEmpresasTable() {
            const tbody = document.getElementById('empresasList');
            const alert = document.getElementById('empresasAlert');
            
            tbody.innerHTML = '';

            if (empresas.length === 0) {
                alert.classList.remove('hidden');
                return;
            }

            alert.classList.add('hidden');
            empresas.sort().forEach(empresa => {
                tbody.innerHTML += `
                    <tr>
                        <td>${empresa}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 6px 12px; margin-right: 4px;" onclick="showEmpresaModal('${empresa}')">Editar</button>
                            <button class="btn btn-danger" style="padding: 6px 12px;" onclick="deleteEmpresa('${empresa}')">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateDepartamentosTable() {
            const tbody = document.getElementById('departamentosList');
            const alert = document.getElementById('departamentosAlert');
            
            tbody.innerHTML = '';

            if (departamentos.length === 0) {
                alert.classList.remove('hidden');
                return;
            }

            alert.classList.add('hidden');
            departamentos.sort().forEach(depto => {
                tbody.innerHTML += `
                    <tr>
                        <td>${depto}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 6px 12px; margin-right: 4px;" onclick="showDepartamentoModal('${depto}')">Editar</button>
                            <button class="btn btn-danger" style="padding: 6px 12px;" onclick="deleteDepartamento('${depto}')">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateDashboard() {
            document.getElementById('totalColaboradores').textContent = colaboradores.filter(c => c.ativo !== false).length;
            
            let totalPositivas = colaboradores.reduce((sum, colab) => sum + (colab.horasPositivas || 0), 0);
            let totalNegativas = colaboradores.reduce((sum, colab) => sum + (colab.horasNegativas || 0), 0);
            
            document.getElementById('totalHorasPositivas').textContent = totalPositivas.toFixed(1);
            document.getElementById('totalHorasNegativas').textContent = totalNegativas.toFixed(1);
            document.getElementById('saldoLiquido').textContent = (totalPositivas - totalNegativas).toFixed(1);

            const activities = document.getElementById('recentActivities');
            
            if (lancamentos.length === 0) {
                activities.innerHTML = '<div style="text-align: center; padding: 20px;">Nenhum lan√ßamento recente</div>';
                return;
            }

            activities.innerHTML = lancamentos.slice(0, 5).map(lanc => {
                const tipoClass = lanc.tipo === 'positiva' ? 'badge-success' : 'badge-danger';
                const tipoIcon = lanc.tipo === 'positiva' ? '‚ûï' : '‚ûñ';
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f1f5f9;">
                        <div>
                            <strong>${lanc.colaboradorNome}</strong>
                            <span class="badge ${tipoClass}" style="margin-left: 8px;">${tipoIcon} ${lanc.horas}h</span>
                        </div>
                        <span style="color: #64748b;">${lanc.data}</span>
                    </div>
                `;
            }).join('');
        }

        // Fechar modais ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            preencherAnos();
        });
    </script>
</body>
</html>