<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Banco de Horas - Firebase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
        }

        .sidebar h2 {
            padding: 0 20px;
            margin-bottom: 30px;
            font-size: 1.2rem;
            border-bottom: 1px solid #34495e;
            padding-bottom: 10px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .sidebar li:hover {
            background-color: #34495e;
        }

        .sidebar li.active {
            background-color: #3498db;
            border-left: 4px solid #2980b9;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            background-color: #f5f5f5;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .card .subtitle {
            color: #7f8c8d;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .recent-activities {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recent-activities h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        /* Forms and Tables */
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-info {
            background-color: #3498db;
            color: white;
        }

        .btn-info:hover {
            background-color: #2980b9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        table {
            width: 100%;
            background-color: white;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th {
            background-color: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 0.9rem;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .status-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .status-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .template-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .template-box h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .template-example {
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }

        .copy-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .copy-btn:hover {
            background-color: #2980b9;
        }

        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .pagination button {
            padding: 5px 10px;
            border: 1px solid #bdc3c7;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .pagination button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }

        .pagination button:hover {
            background-color: #ecf0f1;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Banco de Horas</h2>
            <ul>
                <li onclick="showTab('dashboard')">Dashboard</li>
                <li class="active" onclick="showTab('colaboradores')">Colaboradores</li>
                <li onclick="showTab('lancamentos')">LanÃ§amentos</li>
                <li onclick="showTab('configuracoes')">ConfiguraÃ§Ãµes</li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <h2>Dashboard</h2>
                <div class="dashboard">
                    <div class="card">
                        <h3>Total de Colaboradores</h3>
                        <div class="number" id="totalColaboradores">0</div>
                        <div class="subtitle">Ativos no sistema</div>
                    </div>
                    <div class="card">
                        <h3>Horas Positivas</h3>
                        <div class="number" id="totalHorasPositivas">0</div>
                        <div class="subtitle">Total de horas a compensar</div>
                    </div>
                    <div class="card">
                        <h3>Horas Negativas</h3>
                        <div class="number" id="totalHorasNegativas">0</div>
                        <div class="subtitle">Total de horas em dÃ©bito</div>
                    </div>
                    <div class="card">
                        <h3>Saldo LÃ­quido</h3>
                        <div class="number" id="saldoLiquido">0</div>
                        <div class="subtitle">Positivo - Negativo</div>
                    </div>
                </div>

                <div class="recent-activities">
                    <h3>Ãšltimos LanÃ§amentos</h3>
                    <div id="recentActivities">
                        <!-- Atividades serÃ£o inseridas aqui via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Colaboradores Tab -->
            <div id="colaboradores" class="tab-content active">
                <div class="header-actions">
                    <h2>Colaboradores</h2>
                    <div>
                        <button class="btn btn-success" onclick="showImportModal()">Importar Planilha</button>
                        <button class="btn btn-primary" onclick="showColaboradorModal()">Novo Colaborador</button>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="searchColaborador" placeholder="Buscar por nome, departamento ou empresa..." onkeyup="filterColaboradores()">
                    <select id="filterDepartamento" onchange="filterColaboradores()">
                        <option value="">Todos Departamentos</option>
                    </select>
                    <select id="filterEmpresa" onchange="filterColaboradores()">
                        <option value="">Todas Empresas</option>
                    </select>
                </div>

                <div id="importAlert" class="alert hidden"></div>

                <table id="colaboradoresTable">
                    <thead>
                        <tr>
                            <th onclick="sortColaboradores('nome')" style="cursor: pointer;">Nome Completo ðŸ“Š</th>
                            <th onclick="sortColaboradores('dataAdmissao')" style="cursor: pointer;">Data de AdmissÃ£o ðŸ“Š</th>
                            <th onclick="sortColaboradores('departamento')" style="cursor: pointer;">Departamento ðŸ“Š</th>
                            <th onclick="sortColaboradores('empresa')" style="cursor: pointer;">Empresa ðŸ“Š</th>
                            <th>Horas Positivas</th>
                            <th>Horas Negativas</th>
                            <th>Saldo de Horas</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="colaboradoresList">
                        <!-- Colaboradores serÃ£o inseridos aqui via JavaScript -->
                    </tbody>
                </table>

                <div class="pagination" id="pagination">
                    <!-- PaginaÃ§Ã£o serÃ¡ inserida aqui -->
                </div>
            </div>

            <!-- LanÃ§amentos Tab -->
            <div id="lancamentos" class="tab-content">
                <div class="header-actions">
                    <h2>LanÃ§amentos de Horas</h2>
                    <button class="btn btn-primary" onclick="showLancamentoModal()">Novo LanÃ§amento</button>
                </div>

                <table id="lancamentosTable">
                    <thead>
                        <tr>
                            <th>Colaborador</th>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Quantidade</th>
                            <th>DescriÃ§Ã£o</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="lancamentosList">
                        <!-- LanÃ§amentos serÃ£o inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- ConfiguraÃ§Ãµes Tab -->
            <div id="configuracoes" class="tab-content">
                <h2>ConfiguraÃ§Ãµes</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Empresas -->
                    <div class="card">
                        <div class="header-actions" style="margin-bottom: 15px;">
                            <h3>Empresas</h3>
                            <button class="btn btn-primary" onclick="showEmpresaModal()">Nova Empresa</button>
                        </div>
                        <div id="empresasAlert" class="alert alert-info hidden">Nenhuma empresa cadastrada</div>
                        <table id="empresasTable">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="empresasList">
                                <!-- Empresas serÃ£o inseridas aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Departamentos -->
                    <div class="card">
                        <div class="header-actions" style="margin-bottom: 15px;">
                            <h3>Departamentos</h3>
                            <button class="btn btn-primary" onclick="showDepartamentoModal()">Novo Departamento</button>
                        </div>
                        <div id="departamentosAlert" class="alert alert-info hidden">Nenhum departamento cadastrado</div>
                        <table id="departamentosTable">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="departamentosList">
                                <!-- Departamentos serÃ£o inseridos aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Colaborador -->
    <div id="colaboradorModal" class="modal">
        <div class="modal-content">
            <h3 id="colaboradorModalTitle">Novo Colaborador</h3>
            <form id="colaboradorForm" onsubmit="event.preventDefault(); saveColaborador();">
                <input type="hidden" id="colaboradorId">
                <div class="form-group">
                    <label>Nome Completo:</label>
                    <input type="text" id="colaboradorNome" required>
                </div>
                <div class="form-group">
                    <label>Data de AdmissÃ£o:</label>
                    <input type="text" id="colaboradorData" placeholder="DD/MM/AAAA" required>
                </div>
                <div class="form-group">
                    <label>Departamento:</label>
                    <select id="colaboradorDepartamento" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Empresa:</label>
                    <select id="colaboradorEmpresa" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="hideModal('colaboradorModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal LanÃ§amento -->
    <div id="lancamentoModal" class="modal">
        <div class="modal-content">
            <h3>Novo LanÃ§amento de Horas</h3>
            <form id="lancamentoForm" onsubmit="event.preventDefault(); saveLancamento();">
                <div class="form-group">
                    <label>Colaborador:</label>
                    <select id="lancamentoColaborador" required>
                        <option value="">Selecione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data do LanÃ§amento:</label>
                    <input type="text" id="lancamentoData" placeholder="DD/MM/AAAA" required>
                </div>
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="lancamentoTipo" required>
                        <option value="positiva">Hora Positiva (Extras)</option>
                        <option value="negativa">Hora Negativa (DÃ©bitos)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade de Horas:</label>
                    <input type="number" id="lancamentoHoras" step="0.5" min="0" required>
                </div>
                <div class="form-group">
                    <label>DescriÃ§Ã£o:</label>
                    <textarea id="lancamentoDescricao" rows="3" placeholder="Motivo do lanÃ§amento..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="hideModal('lancamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="empresaModal" class="modal">
        <div class="modal-content">
            <h3>Nova Empresa</h3>
            <form id="empresaForm" onsubmit="event.preventDefault(); saveEmpresa();">
                <div class="form-group">
                    <label>Nome da Empresa:</label>
                    <input type="text" id="empresaNome" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="hideModal('empresaModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Departamento -->
    <div id="departamentoModal" class="modal">
        <div class="modal-content">
            <h3>Novo Departamento</h3>
            <form id="departamentoForm" onsubmit="event.preventDefault(); saveDepartamento();">
                <div class="form-group">
                    <label>Nome do Departamento:</label>
                    <input type="text" id="departamentoNome" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="hideModal('departamentoModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal ImportaÃ§Ã£o -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <h3>Importar Planilha de Colaboradores</h3>
            
            <div class="template-box">
                <h4>ðŸ“‹ Modelo da Planilha</h4>
                <p>Formato: <strong>Nome, Data de AdmissÃ£o (DD/MM/AAAA), Departamento, Empresa</strong></p>
                
                <div class="template-example" id="templateText">
                    JoÃ£o Silva,01/01/2023,TI,Empresa A<br>
                    Maria Santos,15/03/2023,RH,Empresa B<br>
                    Pedro Oliveira,10/02/2023,Financeiro,Empresa A<br>
                    Ana Costa,20/04/2023,Marketing,Empresa C
                </div>
                
                <button class="copy-btn" onclick="copyTemplate()">ðŸ“‹ Copiar Modelo</button>
                <button class="copy-btn" onclick="downloadTemplate()">ðŸ“¥ Baixar Modelo</button>
            </div>

            <form id="importForm" onsubmit="event.preventDefault(); importColaboradores();">
                <div class="form-group">
                    <label>Cole os dados da planilha:</label>
                    <textarea id="importData" rows="8" style="width: 100%; padding: 8px; border: 1px solid #bdc3c7; border-radius: 4px;" placeholder="Cole aqui os dados no formato do modelo acima..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="hideModal('importModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Importar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // ConfiguraÃ§Ã£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDY6qtn4JJPXggiswJjUZCt866oycv_LHk",
            authDomain: "gestao-de-banco-de-horas.firebaseapp.com",
            projectId: "gestao-de-banco-de-horas",
            storageBucket: "gestao-de-banco-de-horas.firebasestorage.app",
            messagingSenderId: "1071713106694",
            appId: "1:1071713106694:web:0a164293419ba46b6e7c87"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Configurar Firestore para usar timestamps
        const settings = { timestampsInSnapshots: true };
        db.settings(settings);

        // VariÃ¡veis globais
        let colaboradores = [];
        let lancamentos = [];
        let empresas = [];
        let departamentos = [];
        
        // VariÃ¡veis para filtros e paginaÃ§Ã£o
        let colaboradoresFiltrados = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let sortField = 'nome';
        let sortDirection = 'asc';

        // FunÃ§Ã£o para mostrar/esconder loading
        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // FunÃ§Ã£o para mostrar tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.sidebar li').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // FunÃ§Ãµes para modais
        function showColaboradorModal(editId = null) {
            loadSelects();
            document.getElementById('colaboradorModal').style.display = 'block';
            if (editId) {
                document.getElementById('colaboradorModalTitle').textContent = 'Editar Colaborador';
                const colab = colaboradores.find(c => c.id === editId);
                if (colab) {
                    document.getElementById('colaboradorId').value = colab.id;
                    document.getElementById('colaboradorNome').value = colab.nome;
                    document.getElementById('colaboradorData').value = colab.dataAdmissao;
                    document.getElementById('colaboradorDepartamento').value = colab.departamento;
                    document.getElementById('colaboradorEmpresa').value = colab.empresa;
                }
            } else {
                document.getElementById('colaboradorModalTitle').textContent = 'Novo Colaborador';
                document.getElementById('colaboradorId').value = '';
                document.getElementById('colaboradorForm').reset();
            }
        }

        function showLancamentoModal() {
            if (colaboradores.length === 0) {
                alert('Cadastre pelo menos um colaborador antes de fazer lanÃ§amentos!');
                return;
            }
            document.getElementById('lancamentoModal').style.display = 'block';
            loadColaboradoresSelect();
        }

        function showEmpresaModal() {
            document.getElementById('empresaModal').style.display = 'block';
        }

        function showDepartamentoModal() {
            document.getElementById('departamentoModal').style.display = 'block';
        }

        function showImportModal() {
            document.getElementById('importModal').style.display = 'block';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'colaboradorModal') {
                document.getElementById('colaboradorForm').reset();
            } else if (modalId === 'lancamentoModal') {
                document.getElementById('lancamentoForm').reset();
            } else if (modalId === 'empresaModal') {
                document.getElementById('empresaForm').reset();
            } else if (modalId === 'departamentoModal') {
                document.getElementById('departamentoForm').reset();
            } else if (modalId === 'importModal') {
                document.getElementById('importForm').reset();
                document.getElementById('importAlert').classList.add('hidden');
            }
        }

        // FunÃ§Ãµes para o modelo de planilha
        function copyTemplate() {
            const template = document.getElementById('templateText').innerText.replace(/<br>/g, '\n');
            navigator.clipboard.writeText(template).then(() => {
                alert('Modelo copiado para a Ã¡rea de transferÃªncia!');
            });
        }

        function downloadTemplate() {
            const template = "JoÃ£o Silva,01/01/2023,TI,Empresa A\nMaria Santos,15/03/2023,RH,Empresa B\nPedro Oliveira,10/02/2023,Financeiro,Empresa A\nAna Costa,20/04/2023,Marketing,Empresa C";
            const blob = new Blob([template], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'modelo_colaboradores.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Inicializar dados padrÃ£o se nÃ£o existirem
        async function initializeDefaultData() {
            try {
                // Verificar se existem empresas
                const empresasSnapshot = await db.collection('empresas').limit(1).get();
                if (empresasSnapshot.empty) {
                    console.log('Criando empresas padrÃ£o...');
                    const defaultEmpresas = ['Empresa A', 'Empresa B', 'Empresa C'];
                    for (const empresa of defaultEmpresas) {
                        await db.collection('empresas').add({ 
                            nome: empresa,
                            createdAt: new Date().toISOString()
                        });
                    }
                }

                // Verificar se existem departamentos
                const deptosSnapshot = await db.collection('departamentos').limit(1).get();
                if (deptosSnapshot.empty) {
                    console.log('Criando departamentos padrÃ£o...');
                    const defaultDeptos = ['TI', 'RH', 'Financeiro', 'Marketing', 'Comercial'];
                    for (const depto of defaultDeptos) {
                        await db.collection('departamentos').add({ 
                            nome: depto,
                            createdAt: new Date().toISOString()
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao inicializar dados padrÃ£o:', error);
            }
        }

        // Carregar dados do Firebase
        async function loadData() {
            showLoading(true);
            try {
                console.log('Carregando dados do Firebase...');
                
                // Inicializar dados padrÃ£o se necessÃ¡rio
                await initializeDefaultData();

                // Carregar colaboradores
                try {
                    const colaboradoresSnapshot = await db.collection('colaboradores').get();
                    colaboradores = colaboradoresSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    console.log('Colaboradores carregados:', colaboradores.length);
                } catch (error) {
                    console.error('Erro ao carregar colaboradores:', error);
                    colaboradores = [];
                }

                // Carregar lanÃ§amentos
                try {
                    const lancamentosSnapshot = await db.collection('lancamentos').orderBy('data', 'desc').get();
                    lancamentos = lancamentosSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    console.log('LanÃ§amentos carregados:', lancamentos.length);
                } catch (error) {
                    console.error('Erro ao carregar lanÃ§amentos:', error);
                    lancamentos = [];
                }

                // Carregar empresas
                try {
                    const empresasSnapshot = await db.collection('empresas').get();
                    empresas = empresasSnapshot.docs.map(doc => doc.data().nome);
                    console.log('Empresas carregadas:', empresas.length);
                } catch (error) {
                    console.error('Erro ao carregar empresas:', error);
                    empresas = [];
                }

                // Carregar departamentos
                try {
                    const departamentosSnapshot = await db.collection('departamentos').get();
                    departamentos = departamentosSnapshot.docs.map(doc => doc.data().nome);
                    console.log('Departamentos carregados:', departamentos.length);
                } catch (error) {
                    console.error('Erro ao carregar departamentos:', error);
                    departamentos = [];
                }

                // Calcular saldo dos colaboradores baseado nos lanÃ§amentos
                calcularSaldos();

                updateAllTables();
            } catch (error) {
                console.error('Erro geral ao carregar dados:', error);
                alert('Erro ao carregar dados do Firebase! Verifique o console para mais detalhes.');
            } finally {
                showLoading(false);
            }
        }

        // FunÃ§Ã£o para calcular saldo dos colaboradores
        function calcularSaldos() {
            // Resetar saldos
            colaboradores.forEach(colab => {
                colab.horasPositivas = 0;
                colab.horasNegativas = 0;
            });

            // Calcular baseado nos lanÃ§amentos
            lancamentos.forEach(lanc => {
                const colaborador = colaboradores.find(c => c.id === lanc.colaboradorId);
                if (colaborador) {
                    if (lanc.tipo === 'positiva') {
                        colaborador.horasPositivas = (colaborador.horasPositivas || 0) + lanc.horas;
                    } else {
                        colaborador.horasNegativas = (colaborador.horasNegativas || 0) + lanc.horas;
                    }
                }
            });
        }

        // Carregar selects
        function loadSelects() {
            const deptoSelect = document.getElementById('colaboradorDepartamento');
            const empresaSelect = document.getElementById('colaboradorEmpresa');
            
            deptoSelect.innerHTML = '<option value="">Selecione...</option>';
            empresaSelect.innerHTML = '<option value="">Selecione...</option>';
            
            if (departamentos.length > 0) {
                departamentos.forEach(depto => {
                    deptoSelect.innerHTML += `<option value="${depto}">${depto}</option>`;
                });
            }
            
            if (empresas.length > 0) {
                empresas.forEach(empresa => {
                    empresaSelect.innerHTML += `<option value="${empresa}">${empresa}</option>`;
                });
            }
        }

        function loadColaboradoresSelect() {
            const select = document.getElementById('lancamentoColaborador');
            select.innerHTML = '<option value="">Selecione...</option>';
            colaboradores.forEach(colab => {
                select.innerHTML += `<option value="${colab.id}">${colab.nome}</option>`;
            });
        }

        // Validar data
        function isValidDate(dateStr) {
            const regex = /^\d{2}\/\d{2}\/\d{4}$/;
            if (!regex.test(dateStr)) return false;
            
            const [day, month, year] = dateStr.split('/').map(Number);
            const date = new Date(year, month - 1, day);
            return date.getDate() === day && date.getMonth() === month - 1 && date.getFullYear() === year;
        }

        // Salvar colaborador
        async function saveColaborador() {
            const id = document.getElementById('colaboradorId').value;
            const nome = document.getElementById('colaboradorNome').value;
            const data = document.getElementById('colaboradorData').value;
            const departamento = document.getElementById('colaboradorDepartamento').value;
            const empresa = document.getElementById('colaboradorEmpresa').value;

            if (!isValidDate(data)) {
                alert('Data invÃ¡lida! Use o formato DD/MM/AAAA');
                return;
            }

            showLoading(true);
            try {
                const colaboradorData = {
                    nome,
                    dataAdmissao: data,
                    departamento,
                    empresa,
                    horasPositivas: 0,
                    horasNegativas: 0,
                    updatedAt: new Date().toISOString()
                };

                if (id) {
                    await db.collection('colaboradores').doc(id).update(colaboradorData);
                } else {
                    colaboradorData.createdAt = new Date().toISOString();
                    await db.collection('colaboradores').add(colaboradorData);
                }

                await loadData();
                hideModal('colaboradorModal');
            } catch (error) {
                console.error('Erro ao salvar colaborador:', error);
                alert('Erro ao salvar no Firebase: ' + error.message);
            }
            showLoading(false);
        }

        // Salvar lanÃ§amento
        async function saveLancamento() {
            const colaboradorId = document.getElementById('lancamentoColaborador').value;
            const data = document.getElementById('lancamentoData').value;
            const tipo = document.getElementById('lancamentoTipo').value;
            const horas = parseFloat(document.getElementById('lancamentoHoras').value);
            const descricao = document.getElementById('lancamentoDescricao').value;

            if (!colaboradorId || !isValidDate(data) || !horas) {
                alert('Preencha todos os campos corretamente!');
                return;
            }

            showLoading(true);
            try {
                // Salvar lanÃ§amento
                const lancamentoData = {
                    colaboradorId,
                    colaboradorNome: colaboradores.find(c => c.id === colaboradorId).nome,
                    data,
                    tipo,
                    horas,
                    descricao,
                    createdAt: new Date().toISOString()
                };

                await db.collection('lancamentos').add(lancamentoData);
                await loadData();
                hideModal('lancamentoModal');
            } catch (error) {
                console.error('Erro ao salvar lanÃ§amento:', error);
                alert('Erro ao salvar no Firebase: ' + error.message);
            }
            showLoading(false);
        }

        // Salvar empresa
        async function saveEmpresa() {
            const nome = document.getElementById('empresaNome').value;
            if (nome) {
                showLoading(true);
                try {
                    await db.collection('empresas').add({ 
                        nome,
                        createdAt: new Date().toISOString()
                    });
                    await loadData();
                    hideModal('empresaModal');
                } catch (error) {
                    console.error('Erro ao salvar empresa:', error);
                    alert('Erro ao salvar no Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        // Salvar departamento
        async function saveDepartamento() {
            const nome = document.getElementById('departamentoNome').value;
            if (nome) {
                showLoading(true);
                try {
                    await db.collection('departamentos').add({ 
                        nome,
                        createdAt: new Date().toISOString()
                    });
                    await loadData();
                    hideModal('departamentoModal');
                } catch (error) {
                    console.error('Erro ao salvar departamento:', error);
                    alert('Erro ao salvar no Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        // Importar colaboradores
        async function importColaboradores() {
            const data = document.getElementById('importData').value;
            const lines = data.split('\n');
            let imported = 0;
            let errors = 0;
            let errorsList = [];

            showLoading(true);
            try {
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const [nome, dataAdmissao, departamento, empresa] = line.split(',').map(item => item.trim());
                        
                        if (nome && dataAdmissao && departamento && empresa) {
                            if (isValidDate(dataAdmissao)) {
                                await db.collection('colaboradores').add({
                                    nome,
                                    dataAdmissao,
                                    departamento,
                                    empresa,
                                    horasPositivas: 0,
                                    horasNegativas: 0,
                                    createdAt: new Date().toISOString()
                                });
                                imported++;
                            } else {
                                errors++;
                                errorsList.push(`Linha ${i + 1}: Data invÃ¡lida (${dataAdmissao})`);
                            }
                        } else {
                            errors++;
                            errorsList.push(`Linha ${i + 1}: Formato invÃ¡lido`);
                        }
                    }
                }

                await loadData();

                let alertMessage = `âœ… ImportaÃ§Ã£o concluÃ­da! ${imported} colaborador(es) importado(s) com sucesso.`;
                if (errors > 0) {
                    alertMessage += `\nâŒ ${errors} linha(s) com erro:\n${errorsList.join('\n')}`;
                }

                const alert = document.getElementById('importAlert');
                alert.textContent = alertMessage;
                alert.className = errors > 0 ? 'alert alert-error' : 'alert alert-success';
                alert.classList.remove('hidden');

                setTimeout(() => {
                    hideModal('importModal');
                }, 5000);
            } catch (error) {
                console.error('Erro ao importar:', error);
                alert('Erro ao importar para o Firebase: ' + error.message);
            }
            showLoading(false);
        }

        // FunÃ§Ãµes de filtro e ordenaÃ§Ã£o
        function filterColaboradores() {
            const searchTerm = document.getElementById('searchColaborador').value.toLowerCase();
            const deptoFilter = document.getElementById('filterDepartamento').value;
            const empresaFilter = document.getElementById('filterEmpresa').value;

            colaboradoresFiltrados = colaboradores.filter(colab => {
                const matchSearch = colab.nome.toLowerCase().includes(searchTerm) ||
                                  colab.departamento.toLowerCase().includes(searchTerm) ||
                                  colab.empresa.toLowerCase().includes(searchTerm);
                const matchDepto = !deptoFilter || colab.departamento === deptoFilter;
                const matchEmpresa = !empresaFilter || colab.empresa === empresaFilter;
                
                return matchSearch && matchDepto && matchEmpresa;
            });

            sortColaboradores(sortField);
            currentPage = 1;
            updateColaboradoresTable();
        }

        function sortColaboradores(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }

            colaboradoresFiltrados.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                
                if (field === 'dataAdmissao') {
                    const [dA, mA, yA] = valA.split('/');
                    const [dB, mB, yB] = valB.split('/');
                    valA = new Date(yA, mA - 1, dA);
                    valB = new Date(yB, mB - 1, dB);
                }
                
                if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            updateColaboradoresTable();
        }

        // Atualizar todas as tabelas
        function updateAllTables() {
            updateFilterOptions();
            colaboradoresFiltrados = [...colaboradores];
            sortColaboradores('nome');
            updateLancamentosTable();
            updateEmpresasTable();
            updateDepartamentosTable();
            updateDashboard();
            loadColaboradoresSelect();
        }

        function updateFilterOptions() {
            const deptoSelect = document.getElementById('filterDepartamento');
            const empresaSelect = document.getElementById('filterEmpresa');
            
            deptoSelect.innerHTML = '<option value="">Todos Departamentos</option>';
            empresaSelect.innerHTML = '<option value="">Todas Empresas</option>';
            
            const deptosUnicos = [...new Set(colaboradores.map(c => c.departamento))];
            deptosUnicos.sort().forEach(depto => {
                deptoSelect.innerHTML += `<option value="${depto}">${depto}</option>`;
            });
            
            const empresasUnicas = [...new Set(colaboradores.map(c => c.empresa))];
            empresasUnicas.sort().forEach(empresa => {
                empresaSelect.innerHTML += `<option value="${empresa}">${empresa}</option>`;
            });
        }

        function updateColaboradoresTable() {
            const tbody = document.getElementById('colaboradoresList');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedColabs = colaboradoresFiltrados.slice(start, end);

            tbody.innerHTML = '';

            if (colaboradoresFiltrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Nenhum colaborador encontrado</td></tr>';
                updatePagination();
                return;
            }

            paginatedColabs.forEach(colab => {
                const saldo = (colab.horasPositivas || 0) - (colab.horasNegativas || 0);
                const statusClass = saldo >= 0 ? 'status-positive' : 'status-negative';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${colab.nome}</td>
                        <td>${colab.dataAdmissao}</td>
                        <td>${colab.departamento}</td>
                        <td>${colab.empresa}</td>
                        <td class="status-positive">${colab.horasPositivas || 0} h</td>
                        <td class="status-negative">${colab.horasNegativas || 0} h</td>
                        <td class="${statusClass}">${saldo} h</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-small" onclick="showColaboradorModal('${colab.id}')">Editar</button>
                                <button class="btn btn-danger btn-small" onclick="deleteColaborador('${colab.id}')">Excluir</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(colaboradoresFiltrados.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            pagination.innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            updateColaboradoresTable();
        }

        function updateLancamentosTable() {
            const tbody = document.getElementById('lancamentosList');
            tbody.innerHTML = '';

            if (lancamentos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum lanÃ§amento registrado</td></tr>';
                return;
            }

            lancamentos.slice(0, 20).forEach(lanc => {
                const tipoClass = lanc.tipo === 'positiva' ? 'status-positive' : 'status-negative';
                const tipoText = lanc.tipo === 'positiva' ? 'Hora Extra' : 'DÃ©bito';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${lanc.colaboradorNome}</td>
                        <td>${lanc.data}</td>
                        <td class="${tipoClass}">${tipoText}</td>
                        <td>${lanc.horas} h</td>
                        <td>${lanc.descricao || '-'}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteLancamento('${lanc.id}')">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateEmpresasTable() {
            const tbody = document.getElementById('empresasList');
            const alert = document.getElementById('empresasAlert');
            
            tbody.innerHTML = '';

            if (empresas.length === 0) {
                alert.classList.remove('hidden');
                return;
            }

            alert.classList.add('hidden');
            empresas.forEach((empresa, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${empresa}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteEmpresa(${index})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateDepartamentosTable() {
            const tbody = document.getElementById('departamentosList');
            const alert = document.getElementById('departamentosAlert');
            
            tbody.innerHTML = '';

            if (departamentos.length === 0) {
                alert.classList.remove('hidden');
                return;
            }

            alert.classList.add('hidden');
            departamentos.forEach((depto, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${depto}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="deleteDepartamento(${index})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Deletar funÃ§Ãµes
        async function deleteColaborador(id) {
            if (confirm('Tem certeza que deseja excluir este colaborador? Todos os lanÃ§amentos relacionados tambÃ©m serÃ£o excluÃ­dos.')) {
                showLoading(true);
                try {
                    // Deletar lanÃ§amentos relacionados
                    const lancamentosRelacionados = lancamentos.filter(l => l.colaboradorId === id);
                    for (const lanc of lancamentosRelacionados) {
                        await db.collection('lancamentos').doc(lanc.id).delete();
                    }
                    
                    await db.collection('colaboradores').doc(id).delete();
                    await loadData();
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar do Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteEmpresa(index) {
            if (confirm('Tem certeza que deseja excluir esta empresa?')) {
                showLoading(true);
                try {
                    const snapshot = await db.collection('empresas').where('nome', '==', empresas[index]).get();
                    const batch = db.batch();
                    snapshot.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                    await loadData();
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar do Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteDepartamento(index) {
            if (confirm('Tem certeza que deseja excluir este departamento?')) {
                showLoading(true);
                try {
                    const snapshot = await db.collection('departamentos').where('nome', '==', departamentos[index]).get();
                    const batch = db.batch();
                    snapshot.forEach((doc) => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                    await loadData();
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar do Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        async function deleteLancamento(id) {
            if (confirm('Tem certeza que deseja excluir este lanÃ§amento?')) {
                showLoading(true);
                try {
                    await db.collection('lancamentos').doc(id).delete();
                    await loadData();
                } catch (error) {
                    console.error('Erro ao deletar:', error);
                    alert('Erro ao deletar do Firebase: ' + error.message);
                }
                showLoading(false);
            }
        }

        // Atualizar Dashboard
        function updateDashboard() {
            document.getElementById('totalColaboradores').textContent = colaboradores.length;
            
            let totalPositivas = colaboradores.reduce((sum, colab) => sum + (colab.horasPositivas || 0), 0);
            let totalNegativas = colaboradores.reduce((sum, colab) => sum + (colab.horasNegativas || 0), 0);
            
            document.getElementById('totalHorasPositivas').textContent = totalPositivas;
            document.getElementById('totalHorasNegativas').textContent = totalNegativas;
            document.getElementById('saldoLiquido').textContent = totalPositivas - totalNegativas;

            // Atividades recentes
            const activities = document.getElementById('recentActivities');
            
            if (lancamentos.length === 0) {
                activities.innerHTML = '<div class="activity-item">Nenhum lanÃ§amento recente</div>';
                return;
            }

            activities.innerHTML = lancamentos.slice(0, 10).map(lanc => `
                <div class="activity-item">
                    <span><strong>${lanc.colaboradorNome}</strong> - ${lanc.tipo === 'positiva' ? '+' : '-'}${lanc.horas}h</span>
                    <span>${lanc.data}</span>
                </div>
            `).join('');
        }

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Iniciando aplicaÃ§Ã£o...');
            loadData();
        });

        // Fechar modais ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>